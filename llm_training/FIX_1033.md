# Fix Error 1033 (tunnel connected but health returns 1033)

1033 means Cloudflare is sending traffic to a tunnel that has **no connected connector**. Usually the hostname is on the **wrong** tunnel.

---

## Your tunnel ID (ISAAC)

The tunnel that runs on ISAAC and must have the hostname:

**`bc473029-6b8b-421e-bb46-b3d77084b35c`**

---

## What to do in Cloudflare (you must do this in your browser)

### Step 1: Open Tunnels

1. Go to **https://one.dash.cloudflare.com**
2. Sign in.
3. Left sidebar: **Networks** → **Tunnels** (or **Connectors** → **Cloudflare Tunnels**).

### Step 2: See which tunnel is HEALTHY

- In the table, check **Status**. The one that shows **HEALTHY** is the one connected from ISAAC.
- Check **Tunnel ID**. It should be **bc473029-6b8b-421e-bb46-b3d77084b35c** when you’re running cloudflared on ISAAC.

### Step 3: Put the hostname on that tunnel only

1. Click the tunnel name **qwen-speechgradebook** that has **Tunnel ID = bc473029-6b8b-421e-bb46-b3d77084b35c** (or the one that is HEALTHY).
2. Open **Public Hostname** / **Route** / **Published application routes**.
3. You should see a route: **qwen.speechgradebook.com** → **http://localhost:8001**.  
   - If you see it and this tunnel is HEALTHY, the route is correct. If you still get 1033, go to Step 4.
   - If you don’t see it, click **Add a public hostname** and set:
     - **Subdomain:** `qwen`
     - **Domain:** `speechgradebook.com`
     - **Type:** HTTP
     - **URL:** `localhost:8001`
     - Save.

### Step 4: If you have TWO tunnels named qwen-speechgradebook

- One might be from your **Mac** (old “service install”), one from **ISAAC**.
- Only the tunnel that is **HEALTHY** (the one running on ISAAC) should have **qwen.speechgradebook.com**.
- For the **other** tunnel (e.g. the one that is INACTIVE or a different Tunnel ID):
  1. Click that tunnel.
  2. Open **Public Hostname** / **Route**.
  3. **Remove** or delete the route for **qwen.speechgradebook.com** (so the hostname exists on only one tunnel).
- Ensure **qwen.speechgradebook.com** exists only on the tunnel with ID **bc473029-6b8b-421e-bb46-b3d77084b35c** (the one that is HEALTHY when you run cloudflared on ISAAC).

### Step 5: Optional – stop the Mac tunnel

If you don’t need the tunnel on your Mac, you can stop it so only ISAAC is used:

- **Mac:**  
  `sudo launchctl unload /Library/LaunchDaemons/com.cloudflare.cloudflared.plist`

Then only the ISAAC tunnel will exist; give it the hostname as in Step 3.

---

## Verify on ISAAC

If the script isn’t on ISAAC yet, copy it from your laptop once:

```bash
scp "/Users/annamcclure/SpeechGradebook Repo/llm_training/check_qwen_tunnel.sh" amcclu12@login.isaac.utk.edu:~/llm_training/
```

On ISAAC (same node where Qwen and the tunnel run):

```bash
cd ~/llm_training
chmod +x check_qwen_tunnel.sh   # once
./check_qwen_tunnel.sh
```

- It prints the **Tunnel ID** from your config (should be bc473029-...).
- It checks **localhost:8001/health**. If that fails, Qwen isn’t running on that node.

---

## After fixing

From your laptop:

```bash
curl -s https://qwen.speechgradebook.com/health
```

You should get JSON like `{"status":"ok","model":"Qwen2.5-VL-7B"}` instead of 1033.
